{% extends 'base.html.twig' %}

{% block title %}Conversation{% endblock %}

{% block body %}
<div class="container-page">
    <a id="conv-return" href="{{ path('app_messagerie') }}"><i class="fa-solid fa-arrow-left"></i></a>
    <div id="correspondant-infos">
        <figure>
            {% if not user.photo %}
                <img src="{{ asset('img/default_user.png') }}" alt="">
            {% else %}
                <img src="{{ asset('uploads/imgUserProfil/'~ user.photo) }}" alt="">   
            {% endif %} 
        </figure>
        <h1>{{ user.pseudo }}</h1>        
    </div>
    <section id="messages-conversation">
        <div id="messages-conv-container">
            {% if messages %}
                {% for message in messages %}
                    {% if message.expediteur.id == app.user.id %}
                        <div class="mon-message">
                            <p>{{ message.texte|raw }} ({{ message.expediteur }})</p>
                            <a href="{{path('remove_message', {'idConversation' : message.destinataire.id, 'id': message.id}) }}">Supprimer le message</a>
                        </div>
                    {% else %}
                        <div class="correspondant-message">
                            <p>{{ message.texte|raw }} ({{ message.expediteur }})</p>
                            <a href="{{path('message_signal', {'id': message.id}) }}">Signaler le message</a>                
                        </div>
                    {% endif %}
                {% endfor %}
            {% else %}
                    <p>Démarrez dès à présent une conversation avec {{ user.pseudo }}</p>
            {% endif %}
        </div>
        <div id="form-conv-message-container">
            {{ form_start(form) }}
                {{ form_row(form.texte) }}
                {# On cache le champ ici car il est setté dans le controller. On ne l'enlève pas du form car on en a besoin dans la messagerie #}
                {{ form_widget(form.destinataire, { 'attr': {'style': 'display:none'} }) }}
                {{ form_row(form.submit) }}
            {{ form_end(form) }}               
        </div>
    </section>

</div>
{% endblock %}
