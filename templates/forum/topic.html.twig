{% extends 'base.html.twig' %}

{% block title %}{{topic.titre}}{% endblock %}

{% block body %}

<div class="container-page forum-page">
    <section id="banniere-topic">
        <h1>{{ topic.titre }}</h1>        
    </section>
    <p class="fil-ariane"> <a href="{{ path('app_home') }}">Accueil</a> &lt; <a href="{{ path('app_forum') }}"> Forum </a> &lt; <a href="{{path('show_histoire', {'slug' : topic.slug}) }}">{{ topic.titre }}</a></p>
    <section id="topic">
        {% if app.user == topic.auteur or app.user and app.user.roles.0 == "ROLE_ADMIN" %}
            <a href="{{path('remove_topic', {'slug': topic.slug}) }}">Supprimer le topic</a>
            <a href="{{ path('edit_topic', {'slug': topic.slug}) }}">Edit</a>
            {% if topic.isVerrouillage %}
                <a href="{{ path('verrouillage_topic', {'id': topic.id}) }}">Déverouiller le topic</a> 
            {% else %}
                <a href="{{ path('verrouillage_topic', {'id': topic.id}) }}">Verouiller le topic</a>
            {% endif %}
        {% endif %}
    </section>
    <section id="posts">
        {% for post in posts %}
            <article class="post">
                <div class="user-post-infos">
                    <figure>
                        {% if post.auteur.photo != null %}
                            <img src="{{ asset('uploads/imgUser/'~ post.auteur.photo) }}" alt="profil de {{ post.auteur }}">
                        {% else %}
                            <img src="{{ asset('img/default_user.png') }}" alt="">
                        {% endif %}
                    </figure>    
                    <div class="infos-sup">
                        {% if post.auteur != null %}
                            <a href="{{ path('show_profile', {'id': post.auteur.id}) }}">{{ post.auteur }}</a>
                        {% else %}
                            <p>Utilisateur supprimé</p>
                        {% endif %}
                        <p>le {{ topic.dateCreation | date('d-m-Y') }} à {{ topic.dateCreation | date('H:i:s') }}</p>
                    </div>       
                </div>
                <div class="post-texte">
                    <p>{{ post.texte|raw }}</p>                
                </div>
            </article>
        {% endfor %}          
    </section>
    <div class="pagination">
        {{ knp_pagination_render(posts) }}
    </div>
    <section class="ajout-posts">
        {% if not topic.isVerrouillage %}
            <h2>Ajouter un message</h2>
            {% if app.user.isVerified %}
                <div class="formulaire">
                    {{ form_start(formAddPost) }}    
                        <div class="custom-errors">
                            {{ form_errors(formAddPost.texte) }}
                        </div>
                        <div class="form-element">
                            {{ form_row(formAddPost.texte) }}
                        </div>
                        <div class="form-element">
                            {{ form_row(formAddPost.submit) }}
                        </div>
                    {{ form_end(formAddPost) }}                    
                    </div>

            {% else %}
            <p>Veuillez cliquer sur le lien envoyé à votre adresse mail pour pouvoir commenter</p>
            {% endif %}
        {% else %}
            <p>Le topic est verrouillé, vous ne pouvez plus écrire de message</p>
        {% endif %}        
    </section>

</div>
{% endblock %}
